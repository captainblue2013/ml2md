<div class="am-g am-g-fixed">
  <div class="am-u-md-9 am-u-md-push-3">
      <div class="am-g am-g-fixed">
          <div class="am-u-sm-11 am-u-sm-centered">
              <div class="am-cf am-article">
                  
  <link rel="stylesheet" href="/css/agate.min.css">

  <div id="content">
      <blockquote class="blockquote-fixed"><span class="am-fr">04/17/2018</span>
          three.js 学习之自转的地球
      </blockquote>
      <p>

          
          <p>首先需要知道什么是 three.js。 简单的说，three.js 是一个非常优秀的 WebGL 开源框架, three(3d) + js(javaScript)。其开源项目的地址：</p>

<blockquote>
<p>github: https://github.com/mrdoob/three.js</p>
</blockquote>

<p>而 WebGL 是在浏览器中实现三维效果的一套规范。</p>

<p>在 three.js 中有几大重要的概念需要先了解一下：</p>

<ul>
<li>场景（scene）</li>
<li>相机（camera）</li>
<li>渲染器（renderer）</li>
</ul>

<p><strong>关键</strong>：有了这三样东西，我们才能够使用相机将场景渲染到网页上去`</p>

<h4 id="toc_0">1、scene</h4>

<p>在 WebGL 世界里，场景是一个非常重要的概念，它是存放所有物体的容器。在 three.js 里面新建一个场景很简单，new THREE.Scene 实例就好了。代码如下：</p>

<blockquote>
<p>var scene = new THREE.Scene();  // 场景只有一种</p>
</blockquote>

<h4 id="toc_1">2、camera</h4>

<ul>
<li>相机（camera）</li>
</ul>

<blockquote>
<p>var camera = new THREE.PerspectiveCamera(75, window.innerWidth/window.innerHeight, 0.1, 1000) ;</p>
</blockquote>

<p><code>PerspectiveCamera( fov, aspect, near, far )</code></p>

<ul>
<li>fov(Number): 仰角的角度</li>
<li>aspect(Number): 截平面长宽比，多为画布的长宽比。</li>
<li>near(Number): 近面的距离</li>
<li>far(Number): 远面的距离</li>
</ul>

<p>图解 THREE.PerspectiveCamera 参数，如下:
<img src="https://tse3-mm.cn.bing.net/th?id=OIP.3Jjn7ZAyk9IZUQWgLklF2AHaDn&amp;w=300&amp;h=300&amp;p=0&amp;o=5&amp;pid=1.7" alt=""></p>

<h4 id="toc_2">3、renderer</h4>

<p>渲染器决定了渲染的结果应该画在页面的什么元素上面，并且以怎样的方式来绘制。</p>

<div><pre><code class="hljs coffeescript"> var renderer = new THREE.WebGLRenderer();
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);</code></pre></div>

<p>好了，几大概念简单的说了，还不是很明白也不打紧，先看下最终的效果：</p>

<p><img src="http://bluestest.oss-cn-shanghai.aliyuncs.com/earth.gif" alt=""></p>

<h4 id="toc_3">开始画地球</h4>

<p>1、导入 <code>three.min.js</code> 文件，可以下载到本地，也可以采用 cdn, 我这里采用的是下载下来的方式：</p>

<blockquote>
<p>&lt;script src=&quot;assets/plus/threejs/three.min.js&quot;&gt;&lt;/script&gt;</p>
</blockquote>

<p>或者</p>

<blockquote>
<p>&lt;script src=&quot;https://cdn.bootcss.com/three.js/r83/three.min.js&quot;&gt;&lt;/script&gt;</p>
</blockquote>

<p>2、准备渲染器 renderer 的 domElement 元素</p>

<blockquote>
<p>&lt;div id=&quot;canvas-frame&quot;&gt;&lt;/div&gt;</p>
</blockquote>

<p><code>&lt;style&gt;&lt;/style&gt;</code> 中加入 css:</p>

<div><pre><code class="hljs coffeescript"> div#canvas-frame {
   border: none;
   cursor: pointer;
   width: 100%;
   height: 100vh;
   background-color: #EEEEEE;
}</code></pre></div>

<p>3、实例化一个 scence 对象, 用来存放我们的地球实体。</p>

<div><pre><code class="hljs coffeescript">// 场景
var scene;
function initScene() {
 scene = new THREE.Scene();
}</code></pre></div>

<p>4、准备搭建 camera 的位置，和调节角度,在 three.js 里面采用给的是<code>右手坐标系</code>：</p>

<div><pre><code class="hljs coffeescript">// 相机
var camera;
function initCamera() {
 camera = new THREE.PerspectiveCamera(45, width / height, 1, 10000);
 camera.position.x = -500;
 camera.position.y = 500;
 camera.position.z = -500;
}</code></pre></div>

<p>这里采用的是透视相机。 视角越大，看到的场景越大，那么中间的物体相对于整个场景来说，就越小了。</p>

<p>5、准备渲染器 renderer</p>

<div><pre><code class="hljs coffeescript">// 渲染器
var renderer;
function initThree() {
 width = document.getElementById(&#39;canvas-frame&#39;).clientWidth;
 height = document.getElementById(&#39;canvas-frame&#39;).clientHeight;
 // 实例化 THREE.WebGLRenderer 对象。
 renderer = new THREE.WebGLRenderer({
                      antialias: true,
                      alpha: true,
                      canvas: renderer
                    });
 // 设置 renderer 的大小
 renderer.setSize(width, height);
 // 挂载到准备的 domElement 上
 document.getElementById(&#39;canvas-frame&#39;).appendChild(renderer.domElement); 
 // Sets the clear color and opacity.
 renderer.setClearColor(0x000000, 1.0);
}</code></pre></div>

<p>这里对 THREE.WebGLRenderer 实例的参数进行讲解。</p>

<ul>
<li><code>canvas</code> - 渲染器绘制输出的那个 canvas, 这对应于下面的 domElement 属性。如果没有在设置，则会创建一个新的画布元素。</li>
<li><code>antialias</code> - 抗锯齿化</li>
<li><code>alpha</code> - alpha 缓冲区</li>
</ul>

<p>6、画地球啦，这里的地球其实就是在一个球体上贴上带有地球纹路的贴纸。</p>

<div><pre><code class="hljs coffeescript">// 地球
var earthMesh;
function initEarth() {
  // 实例化一个半径为 200 的球体
 var earthGeo = new THREE.SphereGeometry(200, 100, 100);
 var earthMater = new THREE.MeshPhongMaterial({
          map: new THREE.TextureLoader().load(&#39;./assets/earth.jpg&#39;)
      });
 earthMesh = new THREE.Mesh(earthGeo, earthMater);
 scene.add(earthMesh);
}</code></pre></div>

<p>7、给地球加上云层；</p>

<div><pre><code class="hljs coffeescript">// 云
var cloudsMesh;
function initClouds() {

  // 实例化一个球体，半径要比地球的大一点，从而实现云飘咋地球上的感觉
  var cloudsGeo = new THREE.SphereGeometry(201, 100, 100);
  
  // transparent 与 opacity 搭配使用，设置材质的透明度，当 transparent 设为 true 时， 会对材质特殊处理，对性能会有些损耗。
  var cloudsMater = new THREE.MeshPhongMaterial({
      alphaMap: new THREE.TextureLoader().load(&#39;./assets/clouds.jpg&#39;),
      transparent: true,
      opacity: 0.2
  });
  
  cloudsMesh = new THREE.Mesh(cloudsGeo, cloudsMater);
  scene.add(cloudsMesh);
}</code></pre></div>

<p>到这里地球就画完了，但是，就像现实的世界一样，如果你不给它打点光，世界就是漆黑一片的，所以接下来给我们的 scene 加点光吧。</p>

<p>8、给世界来点光，世界还你一片彩。</p>

<div><pre><code class="hljs coffeescript">// 光源
var light;
function initLight() {
  // A light source positioned directly above the scene, with color fading from the sky color to the ground color. 
  // 位于场景正上方的光源，颜色从天空颜色渐变为地面颜色。
  //  var light = new THREE.HemisphereLight(0xffffbb, 0x080820, 1);
  // scene.add(light);
  
  // 环境光
  light = new THREE.AmbientLight(0xFFFFFF);
  light.position.set(100, 100, 200);
  scene.add(light);
  
  // 平行光
  // 位置不同，方向光作用于物体的面也不同，看到的物体各个面的颜色也不一样
  // light = new THREE.DirectionalLight(0xffffbb, 1);
  // light.position.set(-1, 1, 1);
  // scene.add(light);
}</code></pre></div>

<p>这里采用的是环境光，其它注释了的两种光的效果也不错哦~
直到这里，地球就画出来了，但是我们的题目是画一颗自转的地球，那我们如何让它自己转起来呢？我们继续往下看。</p>

<p>9、引入一个控制器，这里如果你足够厉害自己写也可以哦，我采用的开源的。</p>

<div><pre><code class="hljs coffeescript"> &lt;script src=&quot;assets/plus/threejs/js/controls/OrbitControls.js&quot;&gt;&lt;/script&gt;</code></pre></div>

<div><pre><code class="hljs coffeescript"> // 载入控制器
var controls = new THREE.OrbitControls(camera, renderer.domElement);</code></pre></div>

<p>10、定义地球和云层自转的动画，速度不一样会更像哦。这里说说为什么循环动画使用的是 <code>requestAnimationFrame</code>, 而不是更熟知的 <code>setInterval</code>？<code>setInterval</code> 是到点就往任务队列里插，是 JS 引擎的定时器方法；<code>requestAnimationFrame</code> 是跟着浏览器的绘制走，浏览器每次重绘的时候调用，是 DOM 引擎提供的方法。</p>

<div><pre><code class="hljs coffeescript">function animate() {
controls.update();
// 地球自转
earthMesh.rotation.y -= 0.002;
// 漂浮的云层
cloudsMesh.rotation.y -= 0.005;
cloudsMesh.rotation.z += 0.005;
renderer.render(scene, camera);
requestAnimationFrame(animate);
}</code></pre></div>

<p>自转的地球到这里就大功告成啦~</p>

<p>完整的代码见：https://github.com/jiangyuzhen/three-earth</p>

<div><pre><code class="hljs coffeescript">Tips: 有的小伙伴克隆上面的代码后， 用双击 index.html 的方式看不到效果，可以自己搭一个静态服务或者试试 anywhere (随启随用的静态文件服务器)：</code></pre></div>

<p>步骤如下:</p>

<div><pre><code class="hljs coffeescript">// 全局安装
npm i anywhere -g 

// 文件根目录下执行
anywhere</code></pre></div>

<h4 id="toc_4">相关资料</h4>

<ul>
<li>https://threejs.org/</li>
<li>https://github.com/omni360/three.js.sourcecode</li>
<li>http://www.hewebgl.com/article/articledir/3</li>
</ul>
          
      </p>
      
  </div>
  <script src="/js/highlight.min.js"></script>
  <script>
      hljs.initHighlightingOnLoad();
  </script>

              </div>
          </div>
      </div>
  </div>
  <div class="am-u-md-3 am-u-md-pull-9 my-sidebar">
      <div class="am-offcanvas" id="sidebar">
          <div class="am-offcanvas-bar">
              <div id="avatar">
                  <img src="/img/avatar.gif" title="开发者小蓝">
                  <p>开发者小蓝</p>
              </div>
              <ul class="am-nav">
                  <li class="active"><a href="/"><span class="am-icon-home"></span>文章</a></li>
                  <li><a href="/search"><span class="am-icon-search"></span>搜索</a></li>
                  <li><a href="/tags"><span class="am-icon-tags"></span>标签</a></li>
                  <!--<li><a href="/project"><span class="am-icon-code"></span>项目</a></li>-->
                  <li><a href="/about"><span class="am-icon-link"></span>关于</a></li>
              </ul>
              <div class="quick-link">
                  <a target="_blank" href="https://github.com/captainblue2013" class="am-icon-md am-icon-github"></a>
                  <a target="_blank" href="http://weibo.com/lanhaosongzi/profile" class="am-icon-md am-icon-weibo"></a>
                  <a target="_blank" href="http://fyscu.com" class="am-icon-md am-icon-sitemap"></a>
              </div>
          </div>
      </div>
  </div>
  <a href="#sidebar" class="am-btn am-btn-sm am-btn-primary am-icon-bars am-show-sm-only my-button" data-am-offcanvas><span class="am-sr-only">侧栏导航</span></a>
</div>

<script src="/assets/js/jquery.min.js"></script>
<script src="/assets/js/amazeui.min.js"></script>
<script src="/js/common.js"></script>